---
phase: 05-drop-in-acceleration
type: execute
domain: research
---

<objective>
Prototype a drop-in adapter that funnels imperative DOM updates into the deterministic js-host commit boundary.

Purpose: Validate the preferred approach from the discovery phase (virtual DOM-equivalent host + adapter) and prove we can wrap existing code paths without breaking semantics.
Output: Adapter module, runnable prototype script, and updated research notes linking back to Phase 5 findings.
</objective>

<execution_context>
~/.codex/skills/get-shit-done/workflows/execute-phase.md
~/.codex/skills/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-drop-in-acceleration/05-01-PLAN.md
@.planning/phases/05-drop-in-acceleration/DISCOVERY.md
@.planning/phases/03-js-host-integration/03-02-SUMMARY.md
@docs/host-core-api.md
@docs/api.md
@packages/js-host/src/runner.js
@examples/quickstart.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create a drop-in adapter for the js-host runner</name>
  <files>prototypes/dropin/adapter.js</files>
  <action>Build an adapter that exposes `createDropInHost()` which accepts a callback that emits DOM-like writes (`setText`, `setAttr`, `appendChild`). The adapter should translate these writes into PatchOps, call `beginTick`/`commitBatch`, and return the serialization/fingerprint. Guard against mutations outside commit and reuse js-host runner via `packages/js-host/src/runner.js`.</action>
  <verify>Adapter applies a short batch (EnsureNode + SetText + AppendChild) and returns fingerprint matching `packages/js-host/src/replay.js`.</verify>
  <done>Adapter translates imperative writes into deterministic PatchBatch commits with fingerprint output.</done>
</task>

<task type="auto">
  <name>Task 2: Add runnable prototype script</name>
  <files>prototypes/dropin/example.js, prototypes/dropin/framework.js, prototypes/dropin/framework-example.js</files>
  <action>Write scripts that use the adapter to simulate an existing app issuing DOM writes before each tick and render a React-like view tree through the adapter. Show two ticks with different text, log serialized DOM/fingerprint, and ensure each tick produces exactly one commit. Document expected output in comments.</action>
  <verify>`node prototypes/dropin/example.js` and `node prototypes/dropin/framework-example.js` run, print serialization/fingerprint, and do not throw.</verify>
  <done>Prototype scripts demonstrate wrapping DOM writes and rendering a simple framework tree into deterministic PatchBatch commits.</done>
</task>

<task type="auto">
  <name>Task 3: Tie prototype back into research notes</name>
  <files>.planning/phases/05-drop-in-acceleration/DISCOVERY.md</files>
  <action>Add a “Prototype” section summarizing what `prototypes/dropin` shows, linking to the adapter/script, and noting any follow-up work. Mention how this prototype validates the decision to defer DOM monkey-patching.</action>
  <verify>DISCOVERY.md includes prototype notes referencing the new files.</verify>
  <done>Discovery doc reflects prototype learnings and points to `prototypes/dropin/adapter.js`.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `node prototypes/dropin/example.js` runs without error
</verification>

<success_criteria>

- Adapter converts imperative writes into deterministic js-host patch batches
- Prototype script shows two commit ticks with serialization/fingerprint
- Discovery notes mention prototype learnings
</success_criteria>

<output>
After completion, create `.planning/phases/05-drop-in-acceleration/05-02-SUMMARY.md`:

# Phase 5 Plan 2: Drop-in Acceleration Prototype Summary

**Substantive one-liner describing prototype proof points and next steps.**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `prototypes/dropin/adapter.js` - Adapter
- `prototypes/dropin/example.js` - Prototype script
- `.planning/phases/05-drop-in-acceleration/DISCOVERY.md` - Updated notes

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

[Prototype follow-up or blockers]
</output>
