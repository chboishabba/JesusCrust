---
phase: 05-drop-in-acceleration
type: execute
domain: research
---

<objective>
Prototype a drop-in adapter that funnels imperative DOM updates into the deterministic js-host commit boundary.

Purpose: Validate the preferred approach from the discovery phase (virtual DOM-equivalent host + adapter) and prove we can wrap existing code paths without breaking semantics.
Output: Adapter module, runnable prototype script, and updated research notes linking back to Phase 5 findings.
</objective>

<execution_context>
~/.codex/skills/get-shit-done/workflows/execute-phase.md
~/.codex/skills/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-drop-in-acceleration/05-01-PLAN.md
@.planning/phases/05-drop-in-acceleration/DISCOVERY.md
@.planning/phases/03-js-host-integration/03-02-SUMMARY.md
@docs/host-core-api.md
@docs/api.md
@packages/js-host/src/runner.js
@examples/quickstart.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create a drop-in adapter for the js-host runner</name>
  <files>prototypes/dropin/adapter.js</files>
  <action>Build an adapter that exposes `createDropInHost()` which accepts a callback that emits DOM-like writes (`setText`, `setAttr`, `appendChild`). The adapter should translate these writes into PatchOps, call `beginTick`/`commitBatch`, and return the serialization/fingerprint. Guard against mutations outside commit and reuse js-host runner via `packages/js-host/src/runner.js`.</action>
  <verify>Adapter applies a short batch (EnsureNode + SetText + AppendChild) and returns fingerprint matching `packages/js-host/src/replay.js`.</verify>
  <done>Adapter translates imperative writes into deterministic PatchBatch commits with fingerprint output.</done>
</task>

<task type="auto">
  <name>Task 2: Add runnable prototype script</name>
  <files>prototypes/dropin/example.js, prototypes/dropin/framework.js, prototypes/dropin/framework-example.js, prototypes/dropin/microtask-test.js, prototypes/dropin/mutation-test.js, prototypes/dropin/identity-test.js</files>
  <action>Write scripts that use the adapter to simulate an existing app issuing DOM writes, render a React-like view tree, and exercise microtasks/mutations/identity invariants. Each tick must emit exactly one commit with logged serialization/fingerprint, and the fixtures should show event bridging plus microtask updates.</action>
  <verify>`node prototypes/dropin/example.js`, `node prototypes/dropin/framework-example.js`, `node prototypes/dropin/microtask-test.js`, `node prototypes/dropin/mutation-test.js`, and `node prototypes/dropin/identity-test.js` run without errors and print deterministic output.</verify>
  <done>Prototype scripts prove DOM writes, event bridging, microtasks, mutation guard, and identity invariants hold under the adapter.</done>
</task>

<task type="auto">
  <name>Task 3: Tie prototype back into research notes and contract</name>
  <files>.planning/phases/05-drop-in-acceleration/DISCOVERY.md, docs/dropin_adapter_contract.md</files>
  <action>Add a “Prototype” section summarizing what `prototypes/dropin` shows, linking the adapter/scripts, and noting any follow-up work. Document the drop-in adapter contract (ticks, microtasks, mutation guard, identity, events) in `docs/dropin_adapter_contract.md`.</action>
  <verify>DISCOVERY.md references the prototype/tests and `docs/dropin_adapter_contract.md` describing the enforced invariants.</verify>
  <done>Discovery doc and drop-in contract capture the prototype learnings, tests, and hardening rules.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `node prototypes/dropin/example.js` runs without error
</verification>

<success_criteria>

- Adapter converts imperative writes into deterministic js-host patch batches
- Prototype script shows two commit ticks with serialization/fingerprint
- Discovery notes mention prototype learnings
</success_criteria>

<output>
After completion, create `.planning/phases/05-drop-in-acceleration/05-02-SUMMARY.md`:

# Phase 5 Plan 2: Drop-in Acceleration Prototype Summary

**Substantive one-liner describing prototype proof points and next steps.**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `prototypes/dropin/adapter.js` - Adapter
- `prototypes/dropin/example.js` - Prototype script
- `.planning/phases/05-drop-in-acceleration/DISCOVERY.md` - Updated notes

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

[Prototype follow-up or blockers]
</output>
